# 功能演示 - Telegram 私信机器人

本文档展示机器人的主要功能和使用流程。

## 🎬 功能演示

### 1. 启动机器人

**操作**：在 Telegram 中搜索您的机器人，点击 "Start" 或发送 `/start`

**效果**：
```
👋 欢迎使用 Telegram 私信机器人管理系统！

您好，User！

这是一个功能强大的私信发送管理系统，您可以：
• 管理多个 Telegram 账户
• 创建批量私信任务
• 监控发送进度和状态
• 配置发送参数和限制

请选择下方的功能按钮开始使用：

[📱 账户管理] [📝 任务管理]
[⚙️ 全局设置] [❓ 帮助文档]
```

---

### 2. 添加账户

**流程**：
```
主菜单 → 📱 账户管理 → ➕ 添加账户 → 🔑 Session String
```

**步骤**：

1. **选择添加方式**
   ```
   ➕ 添加账户
   
   请选择添加方式：
   
   [🔑 Session String]
   [📞 手机号登录]
   [🔙 返回]
   ```

2. **输入 Session String**
   ```
   🔑 通过 Session String 添加账户
   
   请发送您的 Telegram Session String：
   （从 Telethon 导出的会话字符串）
   ```
   
   用户输入：`1AQAAAAAZ...（完整的 session string）`

3. **添加成功**
   ```
   ✅ 账户添加成功！
   
   [➕ 添加账户]
   [📋 账户列表]
   [🔙 返回主菜单]
   ```

---

### 3. 查看账户列表

**流程**：
```
主菜单 → 📱 账户管理 → 📋 账户列表
```

**效果**：
```
📋 账户列表

1. ✅ +86 138xxxxxxxx
   状态: active
   今日已发: 15
   创建时间: 2024-12-11

2. ✅ +86 139xxxxxxxx
   状态: active
   今日已发: 8
   创建时间: 2024-12-10

3. ⚠️ +86 150xxxxxxxx
   状态: limited
   今日已发: 50
   创建时间: 2024-12-09

[🔙 返回]
```

---

### 4. 创建任务（TeleRaptor 风格）

**流程**：
```
主菜单 → 📝 任务管理 → ➕ 创建新任务
```

**步骤 1 - 选择消息类型**：
```
➕ 创建新任务

步骤 1/5: 选择消息类型

请选择要发送的消息类型：

[📝 纯文本]
[🖼️ 图片消息]
[🎥 视频消息]
[🎤 语音消息]
[📄 文档文件]
[🔙 返回]
```

用户点击：`📝 纯文本`

**步骤 2 - 选择格式化**：
```
➕ 创建新任务

已选择: 📝 纯文本

步骤 2/5: 选择文本格式化

请选择消息文本的格式化方式：

[📝 Markdown 格式]
[🌐 HTML 格式]
[⚫ 无格式（纯文本）]
[🔙 返回]
```

用户点击：`📝 Markdown 格式`

**步骤 3 - 输入消息模板**：
```
➕ 创建新任务

步骤 3/5: 请输入消息模板

✨ 个性化变量（TeleRaptor 风格）：
{name} - 用户名或名字
{first_name} - 名字
{last_name} - 姓氏
{full_name} - 全名
{username} - @用户名

🎨 Markdown 格式化语法：
**粗体** - 粗体文字
*斜体* - 斜体文字
[链接文字](URL) - 超链接
`代码` - 代码样式

例如: 你好 **{name}**，这是一条测试消息！
```

用户输入：
```
你好 **{name}**！

这是一条重要消息，{first_name}。

访问我们：[官网](https://example.com)

感谢您的关注！
```

**步骤 4 - 输入目标列表**：
```
✅ 消息模板已保存

步骤 4/5: 请输入目标用户列表

📋 支持多种格式：
• 每行一个用户名: @username
• 每行一个用户ID: 123456789
• 混合格式

例如：
@username1
@username2
123456789
```

用户输入：
```
@user1
@user2
@user3
123456789
987654321
```

**任务创建成功**：
```
✅ 任务创建成功！

📋 任务信息：
任务 ID: #1
消息类型: 📝 纯文本
目标数量: 5
使用账户: 2 个
格式化: Markdown

✨ 任务已就绪，可以开始执行！

[➕ 创建新任务]
[📋 任务列表]
[🔙 返回主菜单]
```

---

### 5. 查看任务列表

**流程**：
```
主菜单 → 📝 任务管理 → 📋 任务列表
```

**效果**：
```
📋 任务列表

点击任务查看详情：

[⏳ 任务 #3 - pending]
[▶️ 任务 #2 - running]
[✅ 任务 #1 - completed]
[🔙 返回]
```

---

### 6. 查看任务详情

**点击任务后**：
```
📊 任务详情 #2

状态: running
消息模板: 你好 **{name}**！这是一条重要消息...
目标数量: 100
已发送: 45
失败: 2
创建时间: 2024-12-11 10:30
开始时间: 2024-12-11 10:35

[⏸️ 停止任务]
[📊 查看详情]
[🔙 返回]
```

---

### 7. 执行任务

**点击任务**：
```
📊 任务详情 #3

状态: pending
消息模板: 你好 **{name}**！这是一条重要消息...
目标数量: 50
已发送: 0
失败: 0
创建时间: 2024-12-11 11:00

[▶️ 开始执行]
[📊 查看详情]
[🔙 返回]
```

**点击开始执行**：
```
✅ 任务 #3 已开始执行！

任务将在后台运行，您可以随时查看进度。

[🔙 返回]
```

**后台执行日志**（bot.log）：
```
2024-12-11 11:05:23 - INFO - 消息发送成功: @user1 (类型: text)
2024-12-11 11:06:15 - INFO - 等待 47 秒后发送下一条消息...
2024-12-11 11:07:02 - INFO - 消息发送成功: @user2 (类型: text)
2024-12-11 11:08:20 - INFO - 等待 78 秒后发送下一条消息...
...
```

---

### 8. 全局设置

**流程**：
```
主菜单 → ⚙️ 全局设置
```

**效果**：
```
⚙️ 全局设置

当前配置：
• 每账户每日最大发送: 50 条
• 最小延迟: 30 秒
• 最大延迟: 120 秒

（配置修改请编辑 .env 文件）

[🔙 返回]
```

---

### 9. 帮助文档

**流程**：
```
主菜单 → ❓ 帮助文档
```

**效果**：
```
❓ 帮助文档

📱 账户管理：
• 添加账户：支持通过 Session String 或手机号添加
• 账户列表：查看所有账户状态和发送统计

📝 任务管理：
• 创建任务：设置消息模板、目标列表、选择账户
• 任务列表：查看任务状态和执行进度
• 开始/停止：控制任务执行

⚙️ 全局设置：
• 发送延迟：避免频率限制
• 每日限制：保护账户安全

🔒 安全提示：
• Session String 会加密存储
• 建议设置合理的发送延迟
• 监控账户状态，及时处理异常

⚠️ 免责声明：
请遵守 Telegram 服务条款，不要发送垃圾信息。

[🔙 返回]
```

---

## 🎨 消息个性化演示

### 原始模板：
```
你好 **{name}**！

{full_name}，这是一条重要消息。

访问：[我们的网站](https://example.com)

{first_name}，期待您的回复！
```

### 发送给用户 @john_doe (John Smith)：
```
你好 john_doe！

John Smith，这是一条重要消息。

访问：我们的网站

John，期待您的回复！
```

### 发送给用户 ID 123456789 (张三)：
```
你好 张三！

张三，这是一条重要消息。

访问：我们的网站

张，期待您的回复！
```

---

## 📊 任务执行流程

```
1. 用户创建任务
   ↓
2. 选择消息类型和格式
   ↓
3. 输入消息模板（支持变量）
   ↓
4. 输入目标列表
   ↓
5. 系统自动分配账户
   ↓
6. 用户点击"开始执行"
   ↓
7. 后台开始发送
   ├─ 获取目标用户信息
   ├─ 替换个性化变量
   ├─ 应用格式化
   ├─ 发送消息
   ├─ 记录日志
   ├─ 随机延迟（30-120秒）
   └─ 继续下一个目标
   ↓
8. 任务完成
   └─ 更新状态和统计
```

---

## 🔐 安全特性演示

### 加密存储
- Session String 使用 Fernet 加密
- 数据库中看到的是加密后的字符串：
  ```
  gAAAAABl... (加密的 session string)
  ```

### 用户白名单
- 在 `.env` 中配置：
  ```
  ALLOWED_USERS=123456789,987654321
  ```
- 未授权用户访问：
  ```
  ❌ 您没有权限使用此机器人。
  ```

### 防封机制
- 随机延迟：每次发送间隔 30-120 秒
- 每日限制：单账户最多 50 条/天
- 账户监控：自动检测并暂停受限账户

---

## 📈 统计和监控

### 实时进度
```
任务 #2 - 运行中
进度: 45/100 (45%)
成功: 43
失败: 2
预计剩余时间: ~90分钟
```

### 发送日志
```sql
-- 查看发送日志
SELECT 
  task_id,
  target_user,
  success,
  sent_at,
  error_message
FROM send_logs
WHERE task_id = 2
ORDER BY sent_at DESC;
```

---

## 🎯 TeleRaptor 风格对比

| 功能 | 演示效果 |
|------|----------|
| **富媒体** | 支持文本/图片/视频/语音/文档 |
| **个性化** | 5种变量自动替换用户信息 |
| **格式化** | Markdown 粗体、斜体、链接 |
| **多账户** | 智能轮询分配，负载均衡 |
| **防封** | 随机延迟 + 每日限制 |
| **界面** | 内联按钮，无需命令 |

---

**本演示展示了机器人的核心功能和用户体验。实际使用中，所有交互都通过内联按钮完成，无需记忆任何命令！** 🎉
